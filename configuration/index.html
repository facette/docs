<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Configuring Facette — Facette</title>
<meta name="keywords" content="catalog,configuration,connector,documentation,facette,filter,http,json,metric,origin,plot,provider,server,settings">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<link href="//fonts.googleapis.com/css?family=Roboto+Slab:400,300,700|Source+Code+Pro" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="/style.css" rel="stylesheet">
</head>
<body>
<header>
<a href="https://facette.io/"><img src="/logo.png" alt="Facette"></a>
<ul>
<li><a href="https://blog.facette.io/"><i class="fa fa-rss"></i>Blog</a></li>
<li><a href="https://twitter.com/FacetteIO"><i class="fa fa-twitter"></i>Twitter</a></li>
<li><a href="https://github.com/facette/facette/releases"><i class="fa fa-arrow-circle-o-down"></i>Downloads</a></li>
<li><a href="https://github.com/facette/facette"><i class="fa fa-github"></i>View on Github</a></li>
</ul>
</header>

<nav>
<h1>Menu</h1>
<ul>
<li><a href="/">Documentation</a></li>

<li>
<a href="http://docs.facette.io/architecture">Architecture of Facette</a>
</li>
<li>
<a href="http://docs.facette.io/installing">Installing Facette</a>
</li>
<li class="active">
<a href="http://docs.facette.io/configuration">Configuring Facette</a>
<ul>
<li><a href="http://docs.facette.io/configuration/connectors">Provider Connectors</a></li>
<li><a href="http://docs.facette.io/configuration/filters">Filters</a></li>
</ul>
</li>
<li>
<a href="http://docs.facette.io/usage">Using Facette</a>
</li>
<li>
<a href="http://docs.facette.io/api">API Documentation</a>
</li>
</ul>
</nav>

<section>
<div class="toc">
<div class="title">Table of Contents</div>
<nav id="TableOfContents">
<ul>
<li><a href="#toc_0">Configuration</a>
<ul>
<li><a href="#toc_1">Base Settings</a></li>
<li><a href="#toc_2">Catalog Setup</a>
<ul>
<li><a href="#toc_3">Definining Providers</a></li>
<li><a href="#toc_4">Connectors</a></li>
<li><a href="#toc_5">Filters</a></li>
<li><a href="#toc_6">Optional Provider Settings</a></li>
<li><a href="#toc_7">Example: collectd</a></li>
<li><a href="#toc_8">Example: Graphite</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</div>


<h1 id="toc_0">Configuration</h1>

<p>The main configuration file is passed using <code>-c</code> argument when launching the <code>facette</code> server. If not specified, its
default location is <code>/etc/facette/facette.json</code>.</p>

<p><span class="fa fa-warning"></span> All the configuration files are stored in <a href="http://www.ietf.org/rfc/rfc4627.txt">JSON</a> format, and <strong>must</strong>
feature the extension <code>.json</code>.</p>

<h2 id="toc_1">Base Settings</h2>

<ul>
<li><code>bind</code> (type <em>string</em>): network address and port to listen on (default: <code>&quot;localhost:12003&quot;</code>)</li>
<li><code>base_dir</code> (type <em>string</em>): base Facette application directory holding static files (default: <code>&quot;/usr/share/facette&quot;</code>)</li>
<li><code>data_dir</code> (type <em>string</em>): directory* used to store application data (default: <code>&quot;/var/lib/facette&quot;</code>)</li>
<li><code>pid_file</code> (type <em>string</em>): path* to the PID file (default: <code>&quot;/var/run/facette/facette.pid&quot;</code>)</li>
<li><code>providers_dir</code> (type <em>string</em>): path to the directory containing providers configuration files
(default: <code>&quot;/etc/facette/providers&quot;</code>)</li>
<li><code>url_prefix</code> (type <em>string</em>): URL prefix behind which the server is located if not running at the root of the HTTP
virtual host (e.g. <code>&quot;/facette&quot;</code>)</li>
</ul>

<p><span class="fa fa-warning"></span> * : Requires write permissions</p>

<p>Example:</p>

<pre><code class="javascript">{
    &quot;bind&quot;: &quot;localhost:12003&quot;,
    &quot;base_dir&quot;: &quot;/usr/share/facette&quot;,
    &quot;data_dir&quot;: &quot;/var/lib/facette&quot;,
    &quot;pid_file&quot;: &quot;/var/run/facette/facette.pid&quot;,
    &quot;providers_dir&quot;: &quot;/etc/facette/providers&quot;,
    …
}
</code></pre>

<h2 id="toc_2">Catalog Setup</h2>

<p>Configuring the catalog consists in defining data <em>providers</em>. At this point, we strongly recommend reading about the
<a href="/architecture/">architecture of Facette</a> to understand how the catalog works.</p>

<h3 id="toc_3">Definining Providers</h3>

<p>Defining <em>providers</em> registers data <em>origins</em> in Facette, i.e. where to find <em>sources</em> and their <em>metrics</em>, and how
to add them to the <em>catalog</em>. <em>Providers</em> are defined by a mandatory <code>connector</code> description, and optional <code>filters</code>.
The configuration is stored in a dedicated file in the directory defined by the <code>providers_dir</code> setting in the main
configuration file; you can have as many definition files as your want, for instance if your polling/collect system is
sharded on many storage backends.</p>

<p><span class="fa fa-warning"></span> In case of a syntax error or incorrect configuration setting, the server will
continue its initialization and discard the bogus provider (a warning message will be logged).</p>

<p>Here&rsquo;s what a typical structure of a <em>provider</em> looks like:</p>

<pre><code class="javascript">$ cat /etc/facette/providers/my_metrics.json
{
    &quot;connector&quot;: {
        …
    },

    &quot;filters&quot;: [
        …
    ],

    &quot;refresh_interval&quot;: 300
}

</code></pre>

<p><span class="fa fa-info-circle"></span> The name of the configuration file will be used as <em>origin</em> of the
<em>sources</em>/<em>metrics</em> retrieved from this origin in the catalog, i.e. in the example above “my_metrics”.</p>

<h3 id="toc_4">Connectors</h3>

<p>Facette providers use <em>connectors</em> to know how to bind to <em>origins</em> and to inventory their local <em>sources</em> and
<em>metrics</em>. See <a href="/configuration/connectors/">this page</a> to view the list of available connectors and how to configure them.</p>

<h3 id="toc_5">Filters</h3>

<p>By default the inventory mechanism of Facette providers retrieves <strong>all</strong> the known <em>sources</em> and <em>metrics</em> from the
<em>origin</em>, named according to the <em>origin</em>&rsquo;s storage structure/format. You may want to rename some of the
<em>sources</em>/<em>metrics</em> or even discard some of them to keep the catalog relevant. Enter <a href="/configuration/filters/">filters</a>.</p>

<h3 id="toc_6">Optional Provider Settings</h3>

<ul>
<li><code>refresh_interval</code> (type <em>integer</em>): interval (in seconds) to trigger a periodic refresh of the provider. If <code>0</code>
(default), no periodic refresh is performed.</li>
</ul>

<h3 id="toc_7">Example: collectd</h3>

<p>Here is an actual provider configuration for using files created by the <a href="http://collectd.org/documentation/manpages/collectd.conf.5.shtml#plugin_rrdtool">RRDtool collectd plugin</a>, featuring a few
filters to rewrite original metric names in a more friendly way and discard entropy-related metrics:</p>

<pre><code class="javascript">{
  &quot;connector&quot;: {
    &quot;type&quot;: &quot;rrd&quot;,
    &quot;path&quot;: &quot;/var/lib/collectd/rrd&quot;,
    &quot;pattern&quot;: &quot;(?P&lt;source&gt;[^/]+)/(?P&lt;metric&gt;.+).rrd&quot;
  },

  &quot;filters&quot;: [
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^entropy&quot;, &quot;discard&quot;: true },

    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;/&quot;, &quot;rewrite&quot;: &quot;.&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^cpu-(\\d+)\\.cpu-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;cpu.$1.$2&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^df-(.+)\\.df_complex-(.+)\\.value&quot;, &quot;rewrite&quot;: &quot;df.$1.$2&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^disk-(.+)\\.disk_(.+)&quot;, &quot;rewrite&quot;: &quot;disk.$1.$2&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^interface-(.+)\\.if_(.+)\\.(.+)$&quot;, &quot;rewrite&quot;: &quot;net.$1.$2.$3&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^irq.irq-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;irq.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^load\\.load&quot;, &quot;rewrite&quot;: &quot;load&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^memory\\.memory-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;memory.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^processes\\.ps_state-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;proc.state.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^processes\\.(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;proc.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^swap\\.swap-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;swap.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^swap\\.swap_io-(.+)\\.value$&quot;, &quot;rewrite&quot;: &quot;swap.io.$1&quot; },
    { &quot;target&quot;: &quot;metric&quot;, &quot;pattern&quot;: &quot;^users\\.users\\.value&quot;, &quot;rewrite&quot;: &quot;users.count&quot; }
  ]
}
</code></pre>

<h3 id="toc_8">Example: Graphite</h3>

<p>This configuration snippet shows a provider definition for using a <a href="http://graphite.readthedocs.org/">Graphite webapp</a>, with a filter to rewrite the
underscore-escaped hostname dots back with dots; besides, this provider will self-refresh every hour.</p>

<pre><code class="javascript">{
  &quot;connector&quot;: {
    &quot;type&quot;: &quot;graphite&quot;,
    &quot;url&quot;: &quot;https://graphite.mycorporation.net/&quot;,
    &quot;allow_insecure_tls&quot;: true
  },

  &quot;filters&quot;: [
    { &quot;pattern&quot;: &quot;_&quot;, &quot;rewrite&quot;: &quot;.&quot;, &quot;target&quot;: &quot;source&quot; }
  ],

  &quot;refresh_interval&quot;: 3600
}
</code></pre>
</section>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27237401-3', 'docs.facette.io');
ga('send', 'pageview');
</script>
</body>
</html>

